apiVersion: v1
kind: Pod
metadata:
  name: {{lower .Name}}
  namespace: {{.App}}-{{.Deployment}}
  labels:
    app: {{.App}}
spec:
  containers: {{$p := .}}{{range $i, $c := .Containers}}
    - name: &name_{{index $i}} {{.Name}}
      image: {{$p.Repo}}/{{$p.App}}-{{.Name}}
      ports:
        - name: *&name_{{index $i}}
          containerPort: {{add $p.BasePort $i}}
          protocol: TCP{{end}}
